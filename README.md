# **API проект reviews**

## **Описание**

Проект **reviews** собирает отзывы пользователей на произведения из различных категорий: книги, фильмы, музыка и др.   
Сами произведения не хранятся в системе.

- **Категории**: Например, книги, музыка, фильмы. 
- **Жанры**: Произведения могут иметь жанры из заранее заданного списка (например, сказка, рок, артхаус).  
- **Отзывы и рейтинги**: Пользователи оставляют отзывы и оценивают произведения по шкале от 1 до 10.      
    Средняя оценка формирует рейтинг произведения. Один пользователь может оставить только один отзыв на произведение.  
- **Комментарии**: Пользователи могут комментировать отзывы.  

Добавлять произведения, категории и жанры может только администратор.    
Писать отзывы, ставить оценки и оставлять комментарии могут только аутентифицированные пользователи.

## Роли пользователей в reviews

- **Аноним**:  
  Может просматривать описания произведений, читать отзывы и комментарии.

- **Аутентифицированный пользователь (user)**:  
  Имеет все права Анонима. 
  Дополнительно может:  
  - Публиковать отзывы и ставить оценки произведениям (фильмам, книгам, музыке).  
  - Комментировать чужие отзывы.  
  - Редактировать и удалять свои отзывы и комментарии.  
  Эта роль назначается автоматически всем новым пользователям.

- **Модератор (moderator)**:  
  Имеет все права Аутентифицированного пользователя. Дополнительно может удалять любые отзывы и комментарии.

- **Администратор (admin)**:  
  Полный доступ ко всему функционалу проекта. Может:  
  - Создавать и удалять произведения, категории и жанры.  
  - Управлять ролями пользователей.

- **Суперюзер Django**:  
  Имеет все права Администратора (admin).


## **Стек технологий**   
- **Python 3.9** — язык программирования.
- **Django REST Framework** — фреймворк REST API.
- **SQLite3** — база данных.
- **DSimple JWT** — библиотека для аутентификации через токены.

## **Установка**   

1. **Создание и активация виртуального окружения:**
    ```
    python3.9 -m venv venv

    # Для MacOS/Linux: 
    source venv/bin/activate

    # Для Windows: 
    venv\Scripts\activate
    ```

2. **Установка зависимостей:**
    ```
    pip install -r requirements.txt
    ```

3. **Примените миграций:**
    ```
    python manage.py migrate
    ```

4. **Создание суперпользователя:**
    ```
    python manage.py createsuperuser
    ```

5. **Запуск сервера:**
    ```
    python manage.py runserver
    ```
По умолчанию проект должен быть доступен по адресу <http://127.0.0.1:8000/>

## Импорт данных в БД из CSV.

Все файлы, предназначенные для импорта, должны располагаться в каталоге **/static/data/** относительно корня проекта.    
Файлы должны называться с префиксом `import_` (например, `import_users`, `import_titles` и т.д.).

### Шаги для запуска импорта:

1. **Откройте терминал и перейдите в корневую директорию проекта** .
2. **Запустите соответствующую management-команду** для импорта данных. Пример:
  ```
  
    python manage.py import_{data}
  
  ```
    Здесь вместо {data} подставьте нужное (user, category, comments, genre, genre_title, review, titles). 


  Если при импорте возникнут ошибки, в консоль будут выведены сообщения с описанием проблемы.    
  Если объект из файла отсутствует в базе, он будет создан.     
  Если объект уже существует, его данные будут обновлены.   


## **Примеры запросов к API**
### **Регистрация нового пользователя**
```
POST /api/v1/auth/signup/

{
  "email": required, 
  "username": required
}

На указанный email будет отправлен код подтверждения.  
При необходимости код подтверждения можно запросить повторно.
```

### **Получение JWT-токена**
```
POST /api/v1/auth/token/ 

{
  "username": required, 
  "confirmation_code": required
}

Получение JWT-токена в обмен на username и confirmation code.
```
### **Получение списка всех пользователей**
```
GET /api/v1/users/

Получить список всех пользователей. 
Права доступа: Администратор.
```

### **Добавление пользователя**
```
POST /api/v1/users/

{
"username": required,
"email": required,
"first_name": "string",
"last_name": "string",
"bio": "string",
"role": "user"
}

Добавить нового пользователя.     
Права доступа: Администратор.
```
### **Получение пользователя по username**
```
GET /api/v1/users/{username}/


Получить пользователя по username.        
Права доступа: Администратор.
```
### **Изменение данных пользователя по username**
```
POST /api/v1/users/

{
"username": required,
"email": required,
"first_name": "string",
"last_name": "string",
"bio": "string",
}

Изменить данные пользователя по username.   
Права доступа: Администратор.
```
### **Удаление пользователя по username**
```
DELETE /api/v1/users/{username}/

Удалить пользователя по username.        
Права доступа: Администратор.
```
### **Получение данных своей учетной записи**
```
GET /api/v1/users/me/

Получить данные своей учетной записи.   
Права доступа: Любой авторизованный пользователь.
```
### **Изменение данных своей учетной записи**
```
POST /api/v1/users/

{
"username": not required, not blank,
"email": not required, not blank,
"first_name": "string",
"last_name": "string",
"bio": "string",
}

Изменить данные пользователя по username.   
Права доступа: Администратор.
```
### **Получение списка всех категорий**
```
GET /api/v1/categories/

Получить список всех категорий.    
Права доступа: Доступно без токена.
```
### **Изменение данных своей учетной записи**
```
POST /api/v1/categories/

{
  "name": required,
  "slug": required
}

Создать категорию.   
Права доступа: Администратор.    
Поле slug каждой категории должно быть уникальным.
```
### **Удаление категории**
```
DELETE /api/v1/categories/{slug}/

Удалить категорию.    
Права доступа: Администратор.
```
### **Получение списка всех жанров**
```
GET /api/v1/genres/

Получить список всех жанров.    
Права доступа: Доступно без токена
```
### **Добавление жанра**
```
POST /api/v1/genres/

{
  "name": required,
  "slug": required
}

Добавить жанр.    
Права доступа: Администратор.   
Поле slug каждой категории должно быть уникальным.
```
### **Удаление жанра**
```
DELETE /api/v1/genres/{slug}/

Удаление жанра.    
Права доступа: Администратор.
```
### **Получение списка всех произведений**
```
GET /api/v1/titles/

Получить список всех жанров.    
Права доступа: Доступно без токена
```
### **Добавление произведения**
```
POST /api/v1/titles/

{
  "name": required,
  "year": required,
  "description": "string",
  "genre": required,
  "category": required
}

Добавить новое произведение.   
Права доступа: Администратор.   
При добавлении нового произведения требуется указать уже существующие категорию и жанр.
```
### **Удаление произведения**
```
DELETE /api/v1/titles/{titles_id}/

Удаление произведения.    
Права доступа: Администратор.
```
### **Получение списка всех произведений**
```
GET /api/v1/titles/{titles_id}/

Информация о произведении.    
Права доступа: Доступно без токена.
```
### **Частичное обновление информации о произведении**
```
PATCH /api/v1/titles/{titles_id}/

{
  "name": required,
  "year": required,
  "description": "string",
  "genre": required,
  "category": required
}

Добавить новое произведение.   
Права доступа: Администратор.   
При добавлении нового произведения требуется указать уже существующие категорию и жанр.
```
### **Получение списка всех отзывов**
```
GET /api/v1/titles/{title_id}/reviews/

Получить список всех отзывов.    
Права доступа: Доступно без токена.
```
### **Добавление нового отзыва**
```
POST /api/v1/titles/{title_id}/reviews/

{
  "text": required,
  "score": required
}

Добавить новый отзыв.    
Пользователь может оставить только один отзыв на произведение.    
Права доступа: Аутентифицированные пользователи.
```
### **Удаление отзыва по id**
```
DELETE /api/v1/titles/{title_id}/reviews/{review_id}/

Удалить отзыв по id.    
Права доступа: Автор отзыва, модератор или администратор.
```
### **Полуение отзыва по id**
```
GET /api/v1/titles/{title_id}/reviews/{review_id}/

Получить отзыв по id для указанного произведения.   
Права доступа: Доступно без токена.
```
### **Частичное обновление отзыва по id**
```
PATCH /api/v1/titles/{title_id}/reviews/{review_id}/

{
  "text": required,
  "score": required
}

Частично обновить отзыв по id.    
Права доступа: Автор отзыва, модератор или администратор.
```
### **Получение списка всех комментариев к отзыву**
```
GET /api/v1/titles/{title_id}/reviews/{review_id}/comments/

Получить список всех комментариев к отзыву по id.    
Права доступа: Доступно без токена.
```
### **Добавление комментария к отзыву**
```
POST /api/v1/titles/{title_id}/reviews/{review_id}/comments/

{
  "text": required
}

Добавить новый комментарий для отзыва.   
Права доступа: Аутентифицированные пользователи.
```
### **Удаление комментария к отзыву**
```
DELETE /api/v1/titles/{title_id}/reviews/{review_id}/comments/{comment_id}/

Удалить комментарий к отзыву по id.   
Права доступа: Автор комментария, модератор или администратор.
```
### **Получение комментария к отзыву**
```
GET /api/v1/titles/{title_id}/reviews/{review_id}/comments/{comment_id}/

Получить комментарий для отзыва по id.  
Права доступа: Доступно без токена.
```
### **Частичное обновление комментария к отзыву**
```
PATCH /api/v1/titles/{title_id}/reviews/{review_id}/comments/{comment_id}/

{
  "text": required,
  "score": required
}

Частично обновить комментарий к отзыву по id.    
Права доступа: Автор комментария, модератор или администратор.
```
